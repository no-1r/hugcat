<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hugging Cat</title>
    <style>
        body { display: flex; justify-content: center; align-items: center; height: 100vh; background-color: white; }
        #cat { width: 150px; cursor: pointer; transition: transform 0.2s ease; }
        #cat:active { transform: scale(1.1); }
    </style>
</head>
<body>
    <img id="cat" src="images/catv2.png" alt="Stinker">
    
    <script>
        const cat = document.getElementById("cat");
        const playerId = Math.floor(Math.random() * 1000000).toString(); // Unique player ID
        let hugInProgress = false;

        cat.addEventListener("click", async () => {
            console.log("Cat clicked, sending 'ready'");
            await fetch(`http://127.0.0.1:8000/ready/${playerId}`, { method: "POST" });
        });

        async function checkStatus() {
            try {
                const response = await fetch("http://127.0.0.1:8000/status");
                if (!response.ok){
                    console.error("Server error:", response.status);
                    return

                }
                const data = await response.json();
                if (!data || !data.status) {
                    console.error("Invalid response:", data);
                    return;
                }
                console.log("Received status:", data.status);


                if (data.status === "hug" && !hugInProgress) {
                    hugInProgress = true;
                    cat.src = "images/hug.gif"; // Show hug animation
                    setTimeout(() => { 
                        cat.src = "images/catv2.png"; 
                        hugInProgress = false;
                    }, 2000);
                }
            } catch (error) {
                console.error("Fetch error:", error);
            }
        }

        setInterval(checkStatus, 500); // Poll every 1 second
    </script>
</body>
</html>
